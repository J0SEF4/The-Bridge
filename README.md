# Face Recognition Clustering and Illuimnation direction

This project contains experiments and analysis related to:
- StyleGAN2-ADA, focusing on face projection to latent space, synthetic image generation and illumination attribute direction.
- Facial clustering analysis, using FRGC and LFW dataset.

## Overview

The project is built on **StyleGAN2-ADA** (Adaptive Discriminator Augmentation), a generative adversarial network (GAN) architecture developed by NVIDIA that enables training high-quality generative models with limited datasets.

### Main Components

1. **stylegan2-ada-josefa/**: from NVIDIA
   - Training, generation, and projection scripts
   - Dataset preparation tools
   - **illumination/**, **illumination2/**: Input images used for projection experiments
   - **out/**: Generated images from NVIDIA's StyleGAN model
   - **out_proj/, out_proj2/, out_proj_obama**: Projection results, within the image projection, video and vector.
   - **out_render/**: Render images from the vector obtained in the projection.


2. **experiments/**: Jupyter notebooks with experiments and analysis
   - Projections and renderings
   - Face clustering with FRGC and LFW datasets
   - Illumination experiments

## Project Structure

```
project/
├── stylegan2-ada-josefa/       # StyleGAN2-ADA implementation
│   ├── train.py                # Training script
│   ├── generate.py             # Image generation
│   ├── projector.py            # Latent space projection
│   ├── illumination/           # Input images for projections - Obama, different illumination in face
│   ├── illumination2/          # Input images for projections - Man, same illumination in all image
│   ├── out_proj/               # Projection results (out/ imgs)
│   ├── out_proj_2/             # Projection results (illumination2/ imgs)
│   ├── out_proj_obama/         # Projection results (illumination/ imgs)
│   ├── out_render/             # Images generated from NVIDIA's StyleGAN model from out_proj_2/
|   └── others...
│
├── PPT weekly/                 # PPT documentation from every week
│
└── experiments/                          # Experimental notebooks
    ├── 1_target-proj-render.ipynb        # Projection vs rendering analysis
    ├── frgc cluster/                     # FRGC dataset clustering
    ├── lfw clusters/                     # LFW dataset clustering
    └── illumination/                     # Illumination experiments from projection and StyleGAN
```

## Experiments Performed

### 1. Projection and Rendering
- **Notebook**: `experiments/1_target-proj-render.ipynb`
- **Description**: Comparative analysis between target images, their projections to StyleGAN2 latent space, and generated renderings
- **Metrics**: MSE (Mean Squared Error) and SSIM (Structural Similarity Index)
- **Input Images**: Use the images from out/

### 2. Face Clustering - FRGC
- **Notebooks**: 
  - `experiments/frgc cluster/4_clusters_all.ipynb`
  - `experiments/frgc cluster/4_clusters_filter.ipynb`
- **Description**: Face clustering analysis using the FRGC (Face Recognition Grand Challenge) dataset
- **Technologies**: RetinaFace for face detection + ArcFace for embedding generation
- **Goal**: Group faces by identity and analyze

### 3. Face Clustering - LFW
- **Notebooks**: 
  - `experiments/lfw clusters/3_clusters_all.ipynb`
  - `experiments/lfw clusters/3_clusters_5_10.ipynb`
  - `experiments/lfw clusters/3_clusters_10_15.ipynb`
  - `experiments/lfw clusters/3_clusters_10_25.ipynb`
- **Description**: Clustering analysis with the LFW (Labeled Faces in the Wild) dataset
- **Goal**: Group faces by identity and analyze

### 4. Illumination Experiments
- **Notebooks**: 
  - `experiments/illumination/2_experiment_illumination.ipynb`
  - `experiments/illumination/2_experiment_illumination2.ipynb`
- **Description**: Analysis of different illumination conditions effects on projections and generations

## Files Not Included in Repository

Due to file size limitations, the following data files are NOT included in the repository. But they are saved here: https://drive.google.com/drive/folders/1FflEJ7RteaaUuj1Mp5bczcTsXdSb86dy?usp=sharing.

### 1. FRGC Face Embeddings
**File**: `experiments/frgc cluster/frgc_face_embeddings.csv`

**Description**: This CSV file contains 512-dimensional face embeddings generated by the ArcFace network for all images in the FRGC dataset. It includes the following columns:
- **512 embedding dimensions**: Vector representation of the face in latent space
- **label**: Numeric label for the person's identity
- **image_file**: Image filename
- **person_id**: Unique person identifier (first 5 characters of filename)

**Size**: File too large for version control (>100MB)

**Regeneration**: To regenerate this file, run the notebook `experiments/frgc cluster/4_clusters_all.ipynb` from the beginning. The process includes:
1. Loading the FRGC dataset
2. Face detection with RetinaFace
3. Embedding extraction with ArcFace
4. Saving to CSV format

### 2. Projection Videos 
**Description**: Videos showing the optimization process during projection of real images to StyleGAN2's W latent space. Each video shows how the generated image gradually converges toward the target image through optimization iterations.
**Size**: High-resolution videos exceeding GitHub limits, so it is not on this repository

**Locations**: 
- `stylegan2-ada-josefa/out_proj/out_proj*/proj.mp4`
- `stylegan2-ada-josefa/out_proj_2/out_proj*/proj.mp4`
- `stylegan2-ada-josefa/out_proj_obama/out_proj*/proj.mp4`

## Images, Projection, Render math
- Image **out/** -> Projection **out_proj/** -> Render **out_render** (images generated from StyleGan2-ada)
- Image **illumination/** -> Projection **out_proj_obama/** (images with different light in different part of the face)
- Image **illumination2/** -> Projection **out_proj_2/** (images with different illumination in all image)

## Basic Usage

### Image Generation
```bash
cd stylegan2-ada-josefa
./docker_run.sh python3 generate.py --outdir=out --trunc=1 --seeds=85,265,297,849  --network=https://nvlabs-fi-cdn.nvidia.com/stylegan2-ada-pytorch/pretrained/metfaces.pkl 
```

### Latent Space Projection
```bash
./docker_run.sh python3 projector.py --outdir=out_proj/out_proj1 --target=out/seed0085.png --network=https://nvlabs-fi-cdn.nvidia.com/stylegan2-ada-pytorch/pretrained/ffhq.pkl 
```

### Render
```bash
./docker_run.sh python3 generate.py --outdir=out_render/out_render3 –projected-w=out_proj/out_proj3/projected_w.npz --network=https://nvlabs-fi-cdn.nvidia.com/stylegan2-ada-pytorch/pretrained/ffhq.pkl 
```

## Resources and References

- **Official Repository**: [NVlabs/stylegan2-ada-pytorch](https://github.com/NVlabs/stylegan2-ada-pytorch)
- **FRGC Dataset**: Face Recognition Grand Challenge - Face dataset from University of Notre Dame
- **LFW Dataset**: Labeled Faces in the Wild - Face dataset in natural conditions

## Development Notes

- Pretrained models must be downloaded separately
- Clustering experiments require access to FRGC and LFW datasets
- Scripts are optimized for NVIDIA GPU execution
- Input images for projection experiments are stored in `illumination/` and `illumination2/` folders
- Generated outputs from NVIDIA's StyleGAN model are stored in `out_render/`

## License

This project uses NVIDIA's StyleGAN2-ADA, which is subject to NVIDIA's license. See `stylegan2-ada-josefa/LICENSE.txt` for details.
